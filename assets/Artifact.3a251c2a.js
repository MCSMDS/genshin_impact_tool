import{c as a}from"./Media.5832cf89.js";import{t as e,l as t,a as n}from"./vendor.e698cdd9.js";import{c as r}from"./opencv.be337fbb.js";const o=a=>{const e=r.imread(a);r.cvtColor(e,e,r.COLOR_RGB2GRAY),r.Canny(e,e,8,128,3,!0),r.dilate(e,e,new r.Mat);const t=new r.MatVector;r.findContours(e,t,new r.Mat,r.RETR_EXTERNAL,r.CHAIN_APPROX_SIMPLE);const n=[];for(let i=0;i<t.size();i++)n.push(r.contourArea(t.get(i)));const{x:o,y:s,width:c,height:d}=r.boundingRect(t.get(n.indexOf(Math.max(...n))));return[o+5,s+5,c-5,d-5]},s=a=>{const e=r.imread(a.toCanvas());r.cvtColor(e,e,r.COLOR_RGB2GRAY),r.Canny(e,e,8,128,3,!0),r.dilate(e,e,r.Mat.ones(8,32,r.CV_8U));const t=new r.MatVector;r.findContours(e,t,new r.Mat,r.RETR_EXTERNAL,r.CHAIN_APPROX_SIMPLE);let n=[];for(let o=0;o<t.size();o++){const a=t.get(o),e=r.boundingRect(a),s=e.width/e.height;s>1.5&&s<16&&n.push([e.x,e.y,e.width,e.height])}return n.reverse().slice(0,11)};class c{constructor(){let a="123456789.0%+生之花死羽时沙空杯理冠防御力命值攻击岩元素伤害加成水雷风火冰物充能效率暴治疗精通迷途的勇士平息鸣尊者渡过烈贤人被怜爱少女角斗终幕礼翠绿影流浪大地乐团如盛怒炽炎魔昔日宗室仪染血骑道悠古磐逆飞星沉沦心千牢固苍白追忆注连绝缘旗印";this.encode_table=e=>e.map((e=>a.indexOf(e)+1)),this.decode_table=e=>e.map((e=>a[e-1]||""))}removeRepetition(a){let e=[];for(let t in a)a[t]!=a[t-1]&&e.push(a[t]);return e}decode(a){return a.argMax(2).arraySync().map(this.removeRepetition).map(this.decode_table).map((a=>a.join("")))}}const d=(a,t)=>{let n=r.imread(a);r.cvtColor(n,n,r.COLOR_RGBA2GRAY),r.blur(n,n,new r.Size(3,3));let o=Math.min(...n.data);n.data.map(((a,e)=>n.data[e]=n.data[e]-o));let s=Math.max(...n.data);n.data.map(((a,e)=>n.data[e]=n.data[e]/s*255)),n.data[n.data.length-1]>=127.5&&n.data.map(((a,e)=>n.data[e]=255-n.data[e]));let c=new r.Mat;r.threshold(n,c,0,255,r.THRESH_OTSU),c=e(c.data,[c.rows,c.cols],"bool");let[d,i]=[c.any(0),c.any(1)],l=d.argMax().arraySync();if(t){let a=d.arraySync().slice(l).indexOf(0);l=l+a+d.arraySync().slice(l+a).indexOf(1)}let p=i.argMax().arraySync(),m=n.cols-d.reverse().argMax().arraySync()-l,R=n.rows-i.reverse().argMax().arraySync()-p;return n=n.roi(new r.Rect(l,p,m,R)),r.resize(n,n,new r.Size(32/n.rows*n.cols,32),0,0,r.INTER_LINEAR),r.copyMakeBorder(n,n,0,0,0,384-n.cols,r.BORDER_CONSTANT),[...n.data].map((a=>a/255))},i=async e=>{const r=a=>({name:(a.split("+")[0]||"").replace(/[^攻击力生命值防御元素充能效率暴伤害精通]/g,""),value:(a.split("+")[1]||"").replace(/[^123456789.0%]/g,"")}),o=s(e);let i=d(a(e.toCanvas(),...o[1])),l=d(a(e.toCanvas(),...o[2])),p=d(a(e.toCanvas(),...o[3])),m=d(a(e.toCanvas(),...o[6]),!0),R=d(a(e.toCanvas(),...o[7]),!0),h=d(a(e.toCanvas(),...o[8]),!0),g=d(a(e.toCanvas(),...o[9]),!0),y=d(a(e.toCanvas(),...o[10])),C=await(async a=>{let e=new c,r=(await t("langPath/model.json")).predict(n(a.flat(),[a.length,32,384,1]));return e.decode(r)})([i,l,p,m,R,h,g,y]);[i,l,p,m,R,h,g,y]=C;return{part:i.replace(/[^生之花死羽时沙空杯理冠]/g,""),main:{name:l.replace(/[^防御力生命值攻击岩元素伤害加成水雷风火冰物理充能效率暴治疗精通]/g,""),value:p.replace(/[^123456789.0%]/g,"")},second1:r(m),second2:r(R),second3:r(h),second4:r(g),alternative:y.replace(/[^冰风迷途的勇士平息鸣雷尊者渡过烈火贤人被怜爱少女角斗终幕礼翠绿之影流浪大地乐团如盛怒炽炎魔昔日宗室仪染血骑道悠古磐岩逆飞星沉沦心千牢固苍白追忆注连绝缘旗印]/g,"")}};export{o as a,s as g,i as r};
